# デバッグとログ（Debug & Log）

**VoiceScriptPlayer** は、実行中に発生したすべての例外・イベント・警告を  
自動的にログファイルとして記録します。  
この機能は、問題の診断やスクリプトの動作検証に非常に役立ちます。

---

## 1. ログファイルの保存場所

すべてのログはデフォルトで **ドキュメントフォルダ** に保存されます。

    C:\Users\<ユーザー名>\Documents\VoiceScriptPlayer\Log

---

## 2. ログファイルの形式

ログファイルは日付またはカテゴリごとに自動分類されます。

| ファイル名の例 | 説明 |
|----------------|------|
| **2025-__-__.log** | 通常実行中に発生したすべてのログ。エディター、サービス、バックエンド全体の記録を含む。 |
| **2025-__-___Player.log** | 再生モード（Playback）中に発生したエラーや例外ログ。Player 専用のイベント記録。 |

すべてのログファイルは UTF-8 で保存され、  
1 日単位で自動生成されます。

---

## 3. ログのカテゴリ

各ログ項目は以下の **カテゴリ（Category）** に分類されます。

| カテゴリ | 説明 |
|-----------|------|
| **UI** | ユーザーインターフェース関連の例外（ボタン、ウィンドウ、コントロール動作など）。 |
| **Domain** | プロジェクトロジック、データ処理、内部演算中のエラー。 |
| **Task** | 非同期タスク、タイマー、バックグラウンド処理関連のエラー。 |
| **Player** | 再生モード（Playback）または編集中の再生時に発生したエラー。デバイス・ファイル・実行制御関連の例外。 |

> 💡 **ヒント：**  
> 「Player」ログは実際の再生環境でのみ生成されます。  
> ただし、エディターで再生中の場合も同様に記録されます。

---

## 4. ログ構造の例

以下は `2025-__-___Player.log` に記録された例です（簡略版）。

    ============================================================
    [Time]     2025-__-__ __:__:__
    [Category] Player
    [Caller]   ExceptionHandler
    [Type]     System.IO.FileNotFoundException
    [Message]  Could not find file '...Sound1.audio'.
    [Source]   System.Private.CoreLib
    [Target]   Microsoft.Win32.SafeHandles.SafeFileHandle.CreateFile(...)
    [StackTrace]
       at System.IO.File.ReadAllText(String path)
       at VoiceScriptPlayer.Models.AudioItem..ctor(...)
       at VoiceScriptPlayer.Core.Event.AudioEvent.get_AudioItem() ...
    ============================================================

---

## 5. ログの読み方

| 項目 | 説明 |
|------|------|
| **[Time]** | エラーまたはイベントの発生時刻。 |
| **[Category]** | 発生したモジュールまたは領域。 |
| **[Caller]** | 呼び出し元の関数またはハンドラー名。 |
| **[Type]** | 例外の種類（System.Exception、FileNotFoundException など）。 |
| **[Message]** | エラーの概要メッセージ。 |
| **[Source]** | エラーが発生したアセンブリまたは名前空間。 |
| **[Target]** | 実際に呼び出されたメソッド署名。 |
| **[StackTrace]** | 発生箇所のコード経路（デバッグ用追跡情報）。 |

> 💡 **補足：**  
> StackTrace（スタックトレース）は内部開発用のデバッグ情報です。  
> 一般ユーザーは詳細なコードを理解する必要はありません。  
> 上部の **[Message]** 項目を見るだけで、  
> 多くの場合、エラーの原因を特定できます。

---

## 6. 再生の停止（Playback Halt）

`Player` カテゴリのエラーは単なる記録ではなく、  
**リアルタイムで画面に表示され、再生が自動停止します。**

- エラーメッセージは赤文字で画面に表示されます。  
- 同時に `Player.log` にも記録されます。  
- この状態になると再生が完全に停止し、  
  問題を解決するまでプロジェクトを再起動できません。

例：

    ファイルが見つかりません。
    C:\Users\Documents\VoiceScriptPlayer\Project\新しいプロジェクト\Asset\Sound\新しいサウンド.wav

> 💡 **補足：**  
> この動作はエディターモードと再生モードの両方で同様に発生します。  
> 再生中にファイル欠損やデバイスエラーが起きた場合、即座に停止します。

---

## 7. 問題発生時の対応

VoiceScriptPlayer は予期しないエラーが発生しても自動でログを残します。  
もし再現可能な問題や不具合が繰り返し発生する場合は、  
**該当ログファイルとともに詳細な現象説明を開発者に報告してください。**

報告時に以下の情報を含めるとより早く対応できます：

- エラーが発生した日時と状況  
- 使用していた機能や操作内容  
- エラー発生後の動作や表示状況  

開発者はこれらのログをもとに原因を迅速に分析・修正できます。  
（正式なバグ報告窓口は後日公式に案内予定です。）

---

## 8. デバッグ活用のヒント

- **プロジェクトが実行できない／再生が停止する場合** → `Player.log` を確認  
- **UI の動作が反応しない場合** → `UI` カテゴリログを確認  
- **エラーが頻発する場合** → 最新の日付の `.log` を開いて最後の項目を確認  
- **ファイル欠損またはアクセスエラー** → `[Message]` または `[Target]` に記載されたパスを確認  

---

## 9. 関連ドキュメント

- [再生モード (Playback Mode)](run.md)  
- [ランタイムヘルパー](../editor/runtime-helper.md)
