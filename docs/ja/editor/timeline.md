# タイムライン概要（Timeline Overview）

VoiceScriptPlayer の **タイムライン（Timeline）** は、  
サウンド、ビデオ、Live2D、UI、特殊イベントなどの再生区間を管理する  
**中心的な機能** です。  
すべてのリソースは **トラック（Track）** 単位で整理され、  
各トラックには 1 つ以上の **ノード（Node）** が配置されます。

---

## 1. 基本構造

![timeline-overview](../images/timeline-overview.png)

タイムラインは次のエリアで構成されています。

| エリア | 説明 |
|--------|------|
| **トラックリスト** | 現在のプロジェクトで作成されたトラックが一覧表示されます。 |
| **トラック追加 / 削除ボタン** | 「+ 新しいトラック」ボタンでトラックを作成できます。 |
| **開始トラック設定** | 再生の基準となるトラックを指定します（プレイヤー起動時の開始位置）。 |
| **再生コントロール部** | ▶ 再生 / ⏸ 一時停止 / ⏮ 巻き戻し などのボタンがあります。 |
| **時間スケールバー** | 上部の目盛りで現在時間と全体の長さを表示します。 |
| **ズーム** | `Ctrl + マウスホイール` で拡大・縮小ができます。 |

---

## 2. トラック管理

- 各トラックには **サウンド、ビデオ、Live2D、UI イベント** などを含めることができます。  
- トラック名はダブルクリックで変更可能です。  
- ドラッグ＆ドロップでトラックの順番を入れ替えることができます。  
- トラックを選択すると、そのトラックの **ノードがタイムラインに表示** されます。

> 💡 **ヒント：**  
> 複雑なプロジェクトほど、リソースの種類ごとにトラックを分けると  
> 管理とデバッグが格段にしやすくなります。

---

## 3. ノード（Node）

タイムラインに配置される各リソース単位を **ノード（Node）** と呼びます。  
例：1 つの音声クリップ、1 つのビデオ区間、1 つの Live2D モーションなど。

| 操作 | 説明 |
|------|------|
| **ドラッグ追加** | 左側のリソースタブからタイムラインにドラッグして追加します。 |
| **位置移動** | ノードをドラッグして開始時間を調整します。 |
| **長さ調整** | ノードの端をドラッグして再生時間を変更します。 |
| **コピー / 貼り付け** | `Ctrl + C`, `Ctrl + V` で複製できます。 |
| **削除** | `Delete` キーまたは右クリックメニューで削除します。 |

---

## 4. ノード編集

ノードを右クリックすると、次のようなメニューが表示されます。

| メニュー | 説明 |
|----------|------|
| **条件編集** | 特定条件を満たす場合のみノードが実行されるよう設定します（変数やトリガーなど）。 |
| **時間編集** | ノードの開始・終了時間を手動入力で正確に設定します。 |
| **コピー / 貼り付け** | 他のトラックや時間位置へノードを複製します。 |

> ⚙️ **条件ノード例：**  
> - 変数 `Flag_A` が有効な場合のみ表示  
> - 特定イベント（例：選択肢結果）が真のときだけ再生  
> - 繰り返し再生を禁止 など  

---

## 5. 時間選択と範囲編集

時間スケール上を **ドラッグ** すると、その範囲を選択でき、  
選択範囲に対してさまざまな編集操作を行えます。

![timeline-range](../images/timeline-range.png)

### 🔹 範囲選択の方法
- 時間スケール部分をマウスで **ドラッグ** すると、選択範囲が緑色で表示されます。  
- 選択範囲はすべてのトラックに同時に適用されます（サウンド / Live2D / イベントなど）。

---

### 🔹 右クリックメニュー

選択範囲上で右クリックすると、次のメニューが表示されます：

| メニュー | 説明 |
|----------|------|
| **時間を挿入** | 選択範囲分の時間を途中に挿入し、すべてのノードを後方へ移動します。 |
| **選択範囲を削除** | 選択した時間区間を削除し、後続のノードを前方へ詰めます。 |
| **選択範囲のみ残す** | 選択範囲以外の前後の部分を削除します。 |

> ⚙️ **例：**  
> 3分〜6分の範囲を選択し「選択範囲のみ残す」を実行すると、  
> タイムライン全体がその部分だけ残り、0秒から再配置されます。

---

### 🔹 活用ヒント

- **長尺プロジェクトの特定シーンをプレビュー** するときに便利。  
- **無駄な空白時間を削除** する際にも有効。  
- **時間を挿入** 機能は、イベント間に余白を設けたいときに便利です。  

> 💡 **ヒント：**  
> 選択範囲は **時間単位** で機能するため、  
> 各ノードを個別に修正しなくても全体時間を一括で調整できます。

---

## 6. 時間コントロール

タイムライン上部の **時間コントローラー** で時間を直接操作できます。

| 機能 | 説明 |
|------|------|
| **現在時間** | 再生位置を直接入力またはスライダーで移動。 |
| **全体長さ設定** | タイムライン全体の長さを設定。 |
| **ズーム** | `Ctrl + マウスホイール` で拡大・縮小。 |
| **再生 / 一時停止 / ループ** | プレビュー時、実際のプレイヤーと同じ動作で再生。 |

---

## 7. ノード条件システム

VoiceScriptPlayer のタイムラインは単なる再生順ではなく、  
**論理条件（Condition）** に基づいてノードの有効 / 無効を制御できます。

![node-condition](../images/node-condition.png)

これらの条件は **スクリプトタブ** で宣言された変数やトリガーと連携します。

---

## 8. プレビューと同期

- 下部の ▶ ボタンで全トラックをプレビュー再生できます。  
- プレビュー中は、サウンド・Live2D・UI が同期動作し、  
  **実際のプレイヤーと同じ挙動を再現** します。  
- 特定区間のみをテストしたい場合は、**開始トラック設定** を活用してください。

> 💡 **ヒント：**  
> トラックが複雑な場合は「条件編集」機能を使って、  
> シーン分岐や演出パターンを簡単にテストできます。

---

## 9. 関連ドキュメント

- [サウンド編集](sound.md) — 音声ファイル、字幕生成、トラック構成  
- [スクリプト](script.md) — 条件変数、トリガー定義  
- [特殊イベント](special-event.md) — タイミングベースの演出やエフェクト設定  
- [ランタイムヘルパー](runtime-helper.md) — デバッグと再生テスト  
